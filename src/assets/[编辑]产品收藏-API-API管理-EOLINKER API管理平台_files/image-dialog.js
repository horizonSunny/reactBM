!function(){var e=function(e){var a="image-dialog";e&&(e.fn.imageDialog=function(){var e,t=this.cm,i=this.lang,o=this.editor,l=this.settings,n=t.getCursor(),r=t.getSelection(),d=i.dialog.image,c=this.classPrefix,m=c+"image-iframe",p=c+a;t.focus();var u=function(a){var t=e.find("."+c+"dialog-mask");t[a?"show":"hide"]()};if(o.find("."+p).length<1){var s=(new Date).getTime(),f=l.imageUploadURL+(l.imageUploadURL.indexOf("?")>=0?"&":"?")+"guid="+s;l.crossDomainUpload&&(f+="&callback="+l.uploadCallbackURL+"&dialog_id=editormd-image-dialog-"+s);var g=(l.imageUpload?'<form  autocomplete="off" action="'+f+'" target="'+m+'" method="post" enctype="multipart/form-data" class="'+c+'form">':'<div class="'+c+'form">')+(l.imageUpload?'<iframe name="'+m+'" id="'+m+'" guid="'+s+'"></iframe>':"")+"<label>"+d.url+'</label><input autocomplete="off" type="text" data-url />'+function(){return l.imageUpload?'<div class="'+c+'file-input"><input autocomplete="off" type="file" name="'+c+'image-file" accept="image/*" multiple="multiple"/><input autocomplete="off" type="submit" value="'+d.uploadButton+'" /></div>':""}()+"<br/><label>"+d.alt+'</label><input autocomplete="off" type="text" value="'+r+'" data-alt /><br/><label>'+d.link+'</label><input autocomplete="off" type="text" value="http://" data-link /><br/>'+(l.imageUpload?"</form>":"</div>");if(e=this.createDialog({title:d.title,width:l.imageUpload?465:380,height:254,name:p,content:g,mask:l.dialogShowMask,drag:l.dialogDraggable,lockScreen:l.dialogLockScreen,maskStyle:{opacity:l.dialogMaskOpacity,backgroundColor:l.dialogMaskBgColor},buttons:{enter:[i.buttons.enter,function(){var e=this.find("[data-url]").val(),a=this.find("[data-alt]").val(),i=this.find("[data-link]").val();if(""===e)return alert(d.imageURLEmpty),!1;var o=""!==a?' "'+a+'"':"";return""===i||"http://"===i?t.replaceSelection("!["+a+"]("+e+o+")"):t.replaceSelection("[!["+a+"]("+e+o+")]("+i+o+")"),""===a&&t.setCursor(n.line,n.ch+2),this.hide().lockScreen(!1).hideMask(),!1}],cancel:[i.buttons.cancel,function(){return this.hide().lockScreen(!1).hideMask(),!1}]}}),e.attr("id",c+"image-dialog-"+s),!l.imageUpload)return;var h=e.find('[name="'+c+'image-file"]');h.bind("change",function(){var a=h[0].value;console.log(a);var t=new RegExp("(\\.("+l.imageFormats.join("|")+"))$");return""===a?(alert(d.uploadFileEmpty),!1):t.test(a)?(u(!0),void e.find('[type="submit"]').trigger("click")):(alert(d.formatNotAllowed+l.imageFormats.join(", ")),!1)});var v=function(e,a,t){a>t?$.ajax({type:"POST",url:"/common/Upload/getPublicUploadToken",dataType:"json",contentType:!1,processData:!1,success:function(i){var o=new FormData;o.append("file",e[t]),o.append("key",i.fileName),o.append("token",i.uptoken),$.ajax({type:"POST",url:window.eoSystemObj.PRE_URL_FILE_UPLOAD+"/",data:o,dataType:"json",contentType:!1,processData:!1,success:function(i){var o=$("[data-url]").val();""===o?$("[data-url]").val("https://data.eolinker.com/"+i.key):(o=o+")![](https://data.eolinker.com/"+i.key,$("[data-url]").val(o)),t++,v(e,a,t)}})}}):($('[name="editormd-image-file"]').val(""),u(!1))},k=function(){var e=$('[name="editormd-image-file"]')[0].files;return e.length>0&&v(e,e.length,0),!1};e.find('[type="submit"]').bind("click",k)}e=o.find("."+p),e.find('[type="text"]').val(""),e.find('[type="file"]').val(""),e.find("[data-link]").val("http://"),this.dialogShowMask(e),this.dialogLockScreen(),e.show()})};"function"==typeof require&&"object"==typeof exports&&"object"==typeof module?module.exports=e:e(window.editormd)}();